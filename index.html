<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Profiling Tool</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --secondary: #0ea5e9;
            --accent: #f59e0b;
            --success: #10b981;
            --danger: #ef4444;
            --bg-main: #0f172a;
            --bg-card: #1e293b;
            --bg-card-hover: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --border: #334155;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 2rem;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(37, 99, 235, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(14, 165, 233, 0.1) 0%, transparent 50%);
            animation: drift 20s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes drift {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(5%, 5%) rotate(5deg); }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        header {
            text-align: center;
            margin-bottom: 3rem;
            animation: fadeInDown 0.8s ease-out;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
            font-weight: 300;
        }

        .version-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
            animation: fadeIn 1s ease-out 0.3s both;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .version-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .version-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .version-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 20px 40px rgba(37, 99, 235, 0.2);
        }

        .version-card:hover::before {
            transform: scaleX(1);
        }

        .version-card.active {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.1) 0%, rgba(14, 165, 233, 0.05) 100%);
        }

        .version-card.active::before {
            transform: scaleX(1);
        }

        .version-tag {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .version-card h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .version-card p {
            color: var(--text-muted);
            font-size: 0.9rem;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .version-features {
            list-style: none;
            margin-top: 1rem;
        }

        .version-features li {
            color: var(--text-secondary);
            font-size: 0.85rem;
            padding: 0.4rem 0;
            padding-left: 1.5rem;
            position: relative;
        }

        .version-features li::before {
            content: 'âœ“';
            position: absolute;
            left: 0;
            color: var(--success);
            font-weight: 600;
        }

        .work-area {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            animation: fadeIn 1s ease-out 0.6s both;
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            color: var(--text-secondary);
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        input[type="text"],
        input[type="number"],
        textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--bg-main);
            border: 2px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s ease;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .qualities-list {
            display: grid;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .quality-item {
            background: var(--bg-main);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 1.25rem;
            transition: all 0.3s ease;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .quality-item:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.15);
        }

        .quality-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .quality-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1.1rem;
        }

        .quality-number {
            background: var(--primary);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .slider-container {
            margin: 1rem 0;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: linear-gradient(to right, var(--danger) 0%, var(--accent) 50%, var(--success) 100%);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            transition: all 0.2s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .rating-display {
            text-align: center;
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            font-family: 'JetBrains Mono', monospace;
        }

        button {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            padding: 0.875rem 2rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        button:hover::before {
            width: 300px;
            height: 300px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(37, 99, 235, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button.secondary {
            background: var(--bg-main);
            border: 2px solid var(--border);
        }

        button.secondary:hover {
            border-color: var(--primary);
            background: var(--bg-card-hover);
        }

        button.danger {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
        }

        .button-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 2rem;
        }

        .chart-container {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 2rem;
            margin-top: 2rem;
            animation: fadeIn 1s ease-out 0.9s both;
        }

        .chart-wrapper {
            position: relative;
            height: 500px;
            margin: 2rem auto;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 2rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-main);
            border-radius: 12px;
            overflow: hidden;
        }

        thead {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        }

        th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: white;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.05em;
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            color: var(--text-secondary);
        }

        tr:last-child td {
            border-bottom: none;
        }

        tbody tr {
            transition: background 0.2s ease;
        }

        tbody tr:hover {
            background: var(--bg-card-hover);
        }

        .score-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .score-high {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        .score-medium {
            background: rgba(245, 158, 11, 0.2);
            color: var(--accent);
        }

        .score-low {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .storage-controls {
            background: var(--bg-main);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .saved-profiles {
            display: grid;
            gap: 1rem;
            margin-top: 1rem;
        }

        .saved-profile-item {
            background: var(--bg-card);
            padding: 1rem;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid var(--border);
            transition: all 0.3s ease;
        }

        .saved-profile-item:hover {
            border-color: var(--primary);
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .profile-meta {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .profile-actions {
            display: flex;
            gap: 0.5rem;
        }

        .icon-btn {
            background: var(--bg-main);
            border: 2px solid var(--border);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }

        .icon-btn:hover {
            border-color: var(--primary);
            background: var(--bg-card-hover);
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            h1 {
                font-size: 2rem;
            }

            .version-selector {
                grid-template-columns: 1fr;
            }

            .work-area,
            .chart-container {
                padding: 1.5rem;
            }

            .button-group {
                flex-direction: column;
            }

            button {
                width: 100%;
            }
        }

        .bipolar-scale {
            margin: 1rem 0;
        }

        .bipolar-labels {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
        }

        .bipolar-left {
            color: var(--danger);
            font-weight: 600;
        }

        .bipolar-right {
            color: var(--success);
            font-weight: 600;
        }

        .situations-container {
            background: var(--bg-main);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .situations-container h3 {
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .hidden {
            display: none;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            animation: fadeIn 0.3s ease-out;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 2rem;
            max-width: 900px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            animation: slideIn 0.3s ease-out;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border);
        }

        .modal-header h2 {
            color: var(--text-primary);
            font-size: 1.5rem;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 2rem;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: var(--bg-card-hover);
            color: var(--text-primary);
        }

        .measurements-list {
            display: grid;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .measurement-item {
            background: var(--bg-main);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .measurement-item:hover {
            border-color: var(--primary);
            transform: translateX(5px);
        }

        .measurement-item.selected {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.1) 0%, rgba(14, 165, 233, 0.05) 100%);
        }

        .measurement-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .measurement-label {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1.1rem;
        }

        .measurement-date {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .comparison-controls {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 2px solid var(--border);
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .checkbox-container input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-container label {
            cursor: pointer;
            margin: 0;
            text-transform: none;
            font-weight: 400;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Performance Profiling Tool</h1>
            <p class="subtitle">Ontdek je sterke punten en ontwikkelpunten als atleet</p>
        </header>

        <div class="version-selector">
            <div class="version-card active" onclick="selectVersion('original')">
                <span class="version-tag">Origineel</span>
                <h3>Butler & Hardy (1992)</h3>
                <p>De basis versie met visuele radar grafiek. Ideaal voor teams en beginners.</p>
                <ul class="version-features">
                    <li>8-12 kwaliteiten</li>
                    <li>Simpele 1-10 schaal</li>
                    <li>Radar visualisatie</li>
                    <li>Snelste methode</li>
                </ul>
            </div>

            <div class="version-card" onclick="selectVersion('advanced')">
                <span class="version-tag">Geavanceerd</span>
                <h3>Jones (1993)</h3>
                <p>Met prioritering van ontwikkelpunten via discrepancy scores.</p>
                <ul class="version-features">
                    <li>Belang rating</li>
                    <li>Ideaal niveau bepalen</li>
                    <li>Huidige niveau beoordelen</li>
                    <li>Automatische prioritering</li>
                </ul>
            </div>

            <div class="version-card" onclick="selectVersion('revised')">
                <span class="version-tag">Herzien</span>
                <h3>Gucciardi & Gordon (2009)</h3>
                <p>Diepgaande betekenisgeving met tegengestelden en contextuele situaties.</p>
                <ul class="version-features">
                    <li>Definitie per kwaliteit</li>
                    <li>Tegengestelde bepalen</li>
                    <li>7-punts bipolaire schaal</li>
                    <li>Situatie mapping</li>
                </ul>
            </div>
        </div>

        <div class="work-area">
            <h2 id="workAreaTitle">Originele Versie - Performance Profile</h2>
            
            <div id="profileNameSection" class="input-group">
                <label>Profiel Naam</label>
                <input type="text" id="profileName" placeholder="Bijv. Jan de Vries - Preseason 2024">
                <div id="profileStatus" style="margin-top: 0.5rem; padding: 0.75rem; border-radius: 8px; display: none;">
                    <span id="profileStatusText"></span>
                </div>
                <div id="newMeasurementHelp" style="margin-top: 0.5rem; padding: 1rem; border-radius: 8px; background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(251, 191, 36, 0.05) 100%); border: 2px solid rgba(245, 158, 11, 0.3); display: none;">
                    <strong style="color: var(--accent);">ðŸ’¡ Nieuwe meting toevoegen:</strong>
                    <p style="color: var(--text-secondary); margin-top: 0.5rem; font-size: 0.9rem;">
                        Pas hieronder de scores aan (de kwaliteiten blijven hetzelfde). Klik daarna op "âž• Nieuwe Meting Toevoegen" om deze scores als nieuwe meting op te slaan.
                    </p>
                </div>
            </div>

            <div class="input-group">
                <label>Aantal Kwaliteiten (8-12 aanbevolen)</label>
                <input type="number" id="numQualities" min="1" max="20" value="8">
                <button onclick="generateQualityInputs()" style="margin-top: 1rem;">Genereer Invoervelden</button>
            </div>

            <div id="qualitiesContainer" class="qualities-list"></div>

            <div class="button-group">
                <button onclick="generateProfile()">ðŸ“Š Genereer Profiel</button>
                <button class="secondary" onclick="exportToPDF()">ðŸ“„ Exporteer als PDF</button>
                <button id="saveBtn" class="secondary" onclick="saveProfile()">ðŸ’¾ Profiel Opslaan</button>
                <button class="secondary" onclick="resetProfile()">ðŸ”„ Reset</button>
            </div>
        </div>

        <div id="chartSection" class="chart-container hidden">
            <h2>Visualisatie</h2>
            <div class="chart-wrapper">
                <canvas id="profileChart"></canvas>
            </div>
        </div>

        <div id="tableSection" class="table-container hidden"></div>

        <div class="storage-controls">
            <h3>Opgeslagen Profielen</h3>
            <div id="savedProfilesList" class="saved-profiles"></div>
        </div>

        <!-- Measurements Modal -->
        <div id="measurementsModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalProfileName">Metingen</h2>
                    <button class="close-btn" onclick="closeMeasurementsModal()">Ã—</button>
                </div>
                <div id="measurementsList" class="measurements-list"></div>
                <div class="comparison-controls">
                    <h3>Vergelijk Metingen</h3>
                    <p style="color: var(--text-muted); margin-bottom: 1rem;">Selecteer meerdere metingen om te vergelijken in een grafiek</p>
                    <div id="comparisonCheckboxes"></div>
                    <button onclick="compareSelectedMeasurements()" style="margin-top: 1rem;">ðŸ“Š Vergelijk Geselecteerde</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentVersion = 'original';
        let currentChart = null;
        let profiles = [];
        let currentProfileId = null; // Track which profile we're working with

        // Load saved profiles from localStorage
        function loadProfiles() {
            const saved = localStorage.getItem('performanceProfiles');
            if (saved) {
                profiles = JSON.parse(saved);
                displaySavedProfiles();
            }
        }

        function saveToStorage() {
            localStorage.setItem('performanceProfiles', JSON.stringify(profiles));
        }

        function selectVersion(version) {
            currentVersion = version;
            
            // Update UI
            document.querySelectorAll('.version-card').forEach(card => {
                card.classList.remove('active');
            });
            event.target.closest('.version-card').classList.add('active');

            // Update title
            const titles = {
                'original': 'Originele Versie - Performance Profile',
                'advanced': 'Geavanceerde Versie - Performance Profile',
                'revised': 'Herziene Versie - Performance Profile'
            };
            document.getElementById('workAreaTitle').textContent = titles[version];

            // Reset
            resetProfile();
        }

        function generateQualityInputs() {
            const num = parseInt(document.getElementById('numQualities').value);
            const container = document.getElementById('qualitiesContainer');
            container.innerHTML = '';

            for (let i = 1; i <= num; i++) {
                const qualityDiv = document.createElement('div');
                qualityDiv.className = 'quality-item';
                
                let html = `
                    <div class="quality-header">
                        <input type="text" id="quality_${i}" placeholder="Kwaliteit ${i} (bijv. Techniek, Motivatie, Conditie)" style="flex: 1; margin-right: 1rem;">
                        <div class="quality-number">${i}</div>
                    </div>
                `;

                if (currentVersion === 'original') {
                    html += `
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Huidige Niveau</span>
                                <span class="rating-display" id="rating_${i}">5</span>
                            </div>
                            <input type="range" id="rating_${i}_slider" min="1" max="10" value="5" 
                                   oninput="document.getElementById('rating_${i}').textContent = this.value">
                        </div>
                    `;
                } else if (currentVersion === 'advanced') {
                    html += `
                        <div class="input-group" style="margin-top: 1rem;">
                            <label>Belang (1-10)</label>
                            <input type="number" id="importance_${i}" min="1" max="10" value="5">
                        </div>
                        <div class="input-group">
                            <label>Ideaal Niveau (1-10)</label>
                            <input type="number" id="ideal_${i}" min="1" max="10" value="10">
                        </div>
                        <div class="input-group">
                            <label>Huidig Niveau (1-10)</label>
                            <input type="number" id="current_${i}" min="1" max="10" value="5">
                        </div>
                    `;
                } else if (currentVersion === 'revised') {
                    html += `
                        <div class="input-group" style="margin-top: 1rem;">
                            <label>Definitie van deze kwaliteit</label>
                            <textarea id="definition_${i}" placeholder="Wat betekent deze kwaliteit voor jou?"></textarea>
                        </div>
                        <div class="input-group">
                            <label>Tegengestelde kwaliteit</label>
                            <input type="text" id="opposite_${i}" placeholder="Wat is het tegenovergestelde?">
                        </div>
                        <div class="input-group">
                            <label>Definitie van tegengestelde</label>
                            <textarea id="opposite_def_${i}" placeholder="Wat betekent het tegenovergestelde?"></textarea>
                        </div>
                        <div class="input-group">
                            <label>Belangrijkheid (1-10)</label>
                            <input type="number" id="importance_${i}" min="1" max="10" value="5">
                        </div>
                        <div class="bipolar-scale">
                            <div class="bipolar-labels">
                                <span class="bipolar-left" id="opposite_label_${i}">Tegengestelde</span>
                                <span class="rating-display" id="bipolar_rating_${i}">4</span>
                                <span class="bipolar-right" id="quality_label_${i}">Kwaliteit</span>
                            </div>
                            <input type="range" id="bipolar_${i}" min="1" max="7" value="4" 
                                   oninput="document.getElementById('bipolar_rating_${i}').textContent = this.value">
                        </div>
                    `;
                }

                qualityDiv.innerHTML = html;
                container.appendChild(qualityDiv);
            }

            if (currentVersion === 'revised') {
                addSituationsSection();
            }
        }

        function addSituationsSection() {
            const existing = document.getElementById('situationsSection');
            if (existing) existing.remove();

            const container = document.getElementById('qualitiesContainer');
            const situationsDiv = document.createElement('div');
            situationsDiv.id = 'situationsSection';
            situationsDiv.className = 'situations-container';
            situationsDiv.innerHTML = `
                <h3>Belangrijke Situaties</h3>
                <p style="color: var(--text-muted); margin-bottom: 1rem;">
                    Beschrijf situaties waarin deze kwaliteiten cruciaal zijn (bijv. onder druk, bij uitdagingen, tegenslag)
                </p>
                <textarea id="situations" placeholder="Bijv: 'Bij een achterstand in de laatste minuten van de wedstrijd'"></textarea>
            `;
            container.appendChild(situationsDiv);
        }

        function generateProfile() {
            const num = parseInt(document.getElementById('numQualities').value);
            const data = [];

            for (let i = 1; i <= num; i++) {
                const qualityName = document.getElementById(`quality_${i}`).value;
                if (!qualityName) continue;

                const item = { name: qualityName };

                if (currentVersion === 'original') {
                    item.rating = parseInt(document.getElementById(`rating_${i}_slider`).value);
                } else if (currentVersion === 'advanced') {
                    item.importance = parseInt(document.getElementById(`importance_${i}`).value);
                    item.ideal = parseInt(document.getElementById(`ideal_${i}`).value);
                    item.current = parseInt(document.getElementById(`current_${i}`).value);
                    item.discrepancy = (item.ideal - item.current) * item.importance;
                } else if (currentVersion === 'revised') {
                    item.definition = document.getElementById(`definition_${i}`).value;
                    item.opposite = document.getElementById(`opposite_${i}`).value;
                    item.oppositeDef = document.getElementById(`opposite_def_${i}`).value;
                    item.importance = parseInt(document.getElementById(`importance_${i}`).value);
                    item.bipolar = parseInt(document.getElementById(`bipolar_${i}`).value);
                }

                data.push(item);
            }

            if (data.length === 0) {
                alert('Voeg eerst kwaliteiten toe!');
                return;
            }

            if (currentVersion === 'original') {
                createRadarChart(data);
            } else if (currentVersion === 'advanced') {
                createAdvancedTable(data);
                createBarChart(data);
            } else if (currentVersion === 'revised') {
                createRevisedTable(data);
                createBipolarChart(data);
            }
        }

        function createRadarChart(data) {
            document.getElementById('chartSection').classList.remove('hidden');
            document.getElementById('tableSection').classList.add('hidden');

            const ctx = document.getElementById('profileChart');
            
            if (currentChart) {
                currentChart.destroy();
            }

            currentChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: data.map(d => d.name),
                    datasets: [{
                        label: 'Huidige Niveau',
                        data: data.map(d => d.rating),
                        backgroundColor: 'rgba(37, 99, 235, 0.2)',
                        borderColor: 'rgba(37, 99, 235, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(37, 99, 235, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(37, 99, 235, 1)',
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 10,
                            ticks: {
                                stepSize: 2,
                                color: '#94a3b8',
                                backdropColor: 'transparent',
                                font: { size: 11 }
                            },
                            grid: {
                                color: '#334155'
                            },
                            pointLabels: {
                                color: '#f1f5f9',
                                font: {
                                    size: 12,
                                    weight: '500'
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.95)',
                            titleColor: '#f1f5f9',
                            bodyColor: '#cbd5e1',
                            borderColor: '#334155',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false
                        }
                    }
                }
            });
        }

        function createBarChart(data) {
            document.getElementById('chartSection').classList.remove('hidden');
            
            const ctx = document.getElementById('profileChart');
            
            if (currentChart) {
                currentChart.destroy();
            }

            // Sort by discrepancy score
            const sortedData = [...data].sort((a, b) => b.discrepancy - a.discrepancy);

            currentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedData.map(d => d.name),
                    datasets: [{
                        label: 'Discrepancy Score',
                        data: sortedData.map(d => d.discrepancy),
                        backgroundColor: sortedData.map(d => {
                            if (d.discrepancy > 30) return 'rgba(239, 68, 68, 0.4)';
                            if (d.discrepancy > 15) return 'rgba(245, 158, 11, 0.4)';
                            return 'rgba(16, 185, 129, 0.4)';
                        }),
                        borderColor: sortedData.map(d => {
                            if (d.discrepancy > 30) return 'rgba(239, 68, 68, 0.6)';
                            if (d.discrepancy > 15) return 'rgba(245, 158, 11, 0.6)';
                            return 'rgba(16, 185, 129, 0.6)';
                        }),
                        borderWidth: 1,
                        borderRadius: 4,
                        barThickness: 35
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: { 
                                color: '#94a3b8',
                                font: { size: 11 }
                            },
                            grid: { 
                                color: 'rgba(51, 65, 85, 0.5)',
                                drawBorder: false
                            },
                            border: {
                                display: false
                            }
                        },
                        y: {
                            ticks: { 
                                color: '#cbd5e1',
                                font: { size: 12, weight: '400' }
                            },
                            grid: { 
                                display: false
                            },
                            border: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.95)',
                            titleColor: '#f1f5f9',
                            bodyColor: '#cbd5e1',
                            borderColor: '#334155',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return 'Discrepancy: ' + context.parsed.x;
                                }
                            }
                        }
                    }
                }
            });
        }

        function createBipolarChart(data) {
            document.getElementById('chartSection').classList.remove('hidden');
            
            const ctx = document.getElementById('profileChart');
            
            if (currentChart) {
                currentChart.destroy();
            }

            currentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d.name),
                    datasets: [{
                        label: 'Bipolaire Score',
                        data: data.map(d => d.bipolar),
                        backgroundColor: data.map(d => {
                            if (d.bipolar <= 3) return 'rgba(239, 68, 68, 0.4)';
                            if (d.bipolar <= 5) return 'rgba(245, 158, 11, 0.4)';
                            return 'rgba(16, 185, 129, 0.4)';
                        }),
                        borderColor: data.map(d => {
                            if (d.bipolar <= 3) return 'rgba(239, 68, 68, 0.6)';
                            if (d.bipolar <= 5) return 'rgba(245, 158, 11, 0.6)';
                            return 'rgba(16, 185, 129, 0.6)';
                        }),
                        borderWidth: 1,
                        borderRadius: 4,
                        barThickness: 35
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            min: 1,
                            max: 7,
                            ticks: { 
                                color: '#94a3b8',
                                stepSize: 1,
                                font: { size: 11 }
                            },
                            grid: { 
                                color: 'rgba(51, 65, 85, 0.5)',
                                drawBorder: false
                            },
                            border: {
                                display: false
                            }
                        },
                        y: {
                            ticks: { 
                                color: '#cbd5e1',
                                font: { size: 12, weight: '400' }
                            },
                            grid: { 
                                display: false
                            },
                            border: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.95)',
                            titleColor: '#f1f5f9',
                            bodyColor: '#cbd5e1',
                            borderColor: '#334155',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return 'Score: ' + context.parsed.x + '/7';
                                }
                            }
                        }
                    }
                }
            });
        }

        function createAdvancedTable(data) {
            document.getElementById('tableSection').classList.remove('hidden');
            
            const sorted = [...data].sort((a, b) => b.discrepancy - a.discrepancy);
            
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>Kwaliteit</th>
                            <th>Belang</th>
                            <th>Ideaal</th>
                            <th>Huidig</th>
                            <th>Verschil</th>
                            <th>Discrepancy Score</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            sorted.forEach(item => {
                const diff = item.ideal - item.current;
                const scoreClass = item.discrepancy > 30 ? 'score-high' : 
                                  item.discrepancy > 15 ? 'score-medium' : 'score-low';
                
                html += `
                    <tr>
                        <td><strong>${item.name}</strong></td>
                        <td>${item.importance}/10</td>
                        <td>${item.ideal}/10</td>
                        <td>${item.current}/10</td>
                        <td>${diff}</td>
                        <td><span class="score-badge ${scoreClass}">${item.discrepancy}</span></td>
                    </tr>
                `;
            });

            html += `
                    </tbody>
                </table>
            `;

            document.getElementById('tableSection').innerHTML = html;
        }

        function createRevisedTable(data) {
            document.getElementById('tableSection').classList.remove('hidden');
            
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>Ranking</th>
                            <th>Kwaliteit</th>
                            <th>Definitie</th>
                            <th>Tegengestelde</th>
                            <th>Belang</th>
                            <th>Score (1-7)</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            data.forEach((item, index) => {
                html += `
                    <tr>
                        <td><strong>${index + 1}</strong></td>
                        <td><strong>${item.name}</strong></td>
                        <td>${item.definition || '-'}</td>
                        <td>${item.opposite || '-'}</td>
                        <td>${item.importance}/10</td>
                        <td>${item.bipolar}/7</td>
                    </tr>
                `;
            });

            html += `
                    </tbody>
                </table>
            `;

            const situations = document.getElementById('situations')?.value;
            if (situations) {
                html += `
                    <div class="situations-container" style="margin-top: 2rem;">
                        <h3>Belangrijke Situaties</h3>
                        <p style="color: var(--text-secondary); white-space: pre-wrap;">${situations}</p>
                    </div>
                `;
            }

            document.getElementById('tableSection').innerHTML = html;
        }

        function saveProfile() {
            const profileName = document.getElementById('profileName').value || `Profiel ${new Date().toLocaleDateString('nl-NL')}`;
            const num = parseInt(document.getElementById('numQualities').value);
            const data = [];

            for (let i = 1; i <= num; i++) {
                const qualityName = document.getElementById(`quality_${i}`)?.value;
                if (!qualityName) continue;

                const item = { name: qualityName };

                if (currentVersion === 'original') {
                    item.rating = parseInt(document.getElementById(`rating_${i}_slider`).value);
                } else if (currentVersion === 'advanced') {
                    item.importance = parseInt(document.getElementById(`importance_${i}`).value);
                    item.ideal = parseInt(document.getElementById(`ideal_${i}`).value);
                    item.current = parseInt(document.getElementById(`current_${i}`).value);
                    item.discrepancy = (item.ideal - item.current) * item.importance;
                } else if (currentVersion === 'revised') {
                    item.definition = document.getElementById(`definition_${i}`).value;
                    item.opposite = document.getElementById(`opposite_${i}`).value;
                    item.oppositeDef = document.getElementById(`opposite_def_${i}`).value;
                    item.importance = parseInt(document.getElementById(`importance_${i}`).value);
                    item.bipolar = parseInt(document.getElementById(`bipolar_${i}`).value);
                }

                data.push(item);
            }

            if (data.length === 0) {
                alert('Geen data om op te slaan!');
                return;
            }

            const measurement = {
                data: data,
                date: new Date().toISOString(),
                label: prompt('Label voor deze meting (bijv. "Preseason", "Week 8", "Na trainingskamp"):', 
                              `Meting ${new Date().toLocaleDateString('nl-NL')}`) || `Meting ${new Date().toLocaleDateString('nl-NL')}`
            };

            if (currentVersion === 'revised') {
                measurement.situations = document.getElementById('situations')?.value;
            }

            // Check if we're updating an existing profile or creating a new one
            if (currentProfileId) {
                const profile = profiles.find(p => p.id === currentProfileId);
                if (profile) {
                    if (!profile.measurements) {
                        profile.measurements = [];
                    }
                    profile.measurements.push(measurement);
                    profile.lastUpdated = new Date().toISOString();
                    alert(`Nieuwe meting toegevoegd aan "${profile.name}"!`);
                }
            } else {
                // Create new profile
                const profile = {
                    id: Date.now(),
                    name: profileName,
                    version: currentVersion,
                    measurements: [measurement],
                    created: new Date().toISOString(),
                    lastUpdated: new Date().toISOString()
                };
                profiles.push(profile);
                currentProfileId = profile.id;
                alert('Nieuw profiel aangemaakt!');
            }

            saveToStorage();
            displaySavedProfiles();
        }

        function displaySavedProfiles() {
            const container = document.getElementById('savedProfilesList');
            
            if (profiles.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸ“Š</div>
                        <p>Nog geen opgeslagen profielen</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = profiles.map(profile => {
                const measurementCount = profile.measurements ? profile.measurements.length : (profile.data ? 1 : 0);
                const lastUpdate = new Date(profile.lastUpdated || profile.date || profile.created).toLocaleDateString('nl-NL');
                
                return `
                <div class="saved-profile-item">
                    <div class="profile-info">
                        <div class="profile-name">${profile.name}</div>
                        <div class="profile-meta">
                            ${profile.version === 'original' ? 'Origineel' : 
                              profile.version === 'advanced' ? 'Geavanceerd' : 'Herzien'} 
                            â€¢ ${lastUpdate}
                            â€¢ ${measurementCount} ${measurementCount === 1 ? 'meting' : 'metingen'}
                        </div>
                    </div>
                    <div class="profile-actions">
                        ${measurementCount > 1 ? `<button class="icon-btn" onclick="viewMeasurements(${profile.id})">ðŸ“Š Metingen</button>` : ''}
                        <button class="icon-btn" onclick="loadProfile(${profile.id})">Laden</button>
                        <button class="icon-btn" onclick="deleteProfile(${profile.id})">Verwijderen</button>
                    </div>
                </div>
            `}).join('');
        }

        function loadProfile(id, measurementIndex = null) {
            const profile = profiles.find(p => p.id === id);
            if (!profile) return;

            // Set current profile ID so new saves add to this profile
            currentProfileId = id;

            // Show profile status
            const statusDiv = document.getElementById('profileStatus');
            const statusText = document.getElementById('profileStatusText');
            const measurementCount = profile.measurements ? profile.measurements.length : 0;
            statusDiv.style.display = 'block';
            statusDiv.style.background = 'linear-gradient(135deg, rgba(37, 99, 235, 0.1) 0%, rgba(14, 165, 233, 0.05) 100%)';
            statusDiv.style.border = '2px solid rgba(37, 99, 235, 0.3)';
            statusText.innerHTML = `ðŸ“Š <strong>Actief profiel:</strong> ${profile.name} (${measurementCount} ${measurementCount === 1 ? 'meting' : 'metingen'})`;
            statusText.style.color = 'var(--text-secondary)';

            // Show help for adding new measurement
            document.getElementById('newMeasurementHelp').style.display = 'block';

            // Update save button text
            document.getElementById('saveBtn').innerHTML = 'âž• Nieuwe Meting Toevoegen';

            // Switch to correct version
            currentVersion = profile.version;
            document.querySelectorAll('.version-card').forEach((card, index) => {
                card.classList.remove('active');
                const versions = ['original', 'advanced', 'revised'];
                if (versions[index] === currentVersion) {
                    card.classList.add('active');
                }
            });

            const titles = {
                'original': 'Originele Versie - Performance Profile',
                'advanced': 'Geavanceerde Versie - Performance Profile',
                'revised': 'Herziene Versie - Performance Profile'
            };
            document.getElementById('workAreaTitle').textContent = titles[currentVersion];

            // Set profile name
            document.getElementById('profileName').value = profile.name;
            document.getElementById('profileName').disabled = true; // Disable editing

            // Get the measurement to load
            let measurementData;
            if (profile.measurements && profile.measurements.length > 0) {
                // Load specific measurement or latest one
                const index = measurementIndex !== null ? measurementIndex : profile.measurements.length - 1;
                measurementData = profile.measurements[index].data;
                
                // Show which measurement is loaded
                if (measurementIndex !== null && profile.measurements.length > 1) {
                    const measurementLabel = profile.measurements[index].label;
                    setTimeout(() => {
                        alert(`Geladen: ${measurementLabel} (${index + 1}/${profile.measurements.length})`);
                    }, 100);
                }
            } else if (profile.data) {
                // Old format - convert to new format
                measurementData = profile.data;
            }

            if (!measurementData) return;

            // Set number and generate inputs
            document.getElementById('numQualities').value = measurementData.length;
            document.getElementById('numQualities').disabled = true; // Can't change number of qualities
            generateQualityInputs();

            // Fill in data
            measurementData.forEach((item, index) => {
                const i = index + 1;
                const qualityInput = document.getElementById(`quality_${i}`);
                qualityInput.value = item.name;
                qualityInput.disabled = true; // Can't change quality names

                if (currentVersion === 'original') {
                    document.getElementById(`rating_${i}_slider`).value = item.rating;
                    document.getElementById(`rating_${i}`).textContent = item.rating;
                } else if (currentVersion === 'advanced') {
                    document.getElementById(`importance_${i}`).value = item.importance;
                    document.getElementById(`importance_${i}`).disabled = true; // Importance stays the same
                    document.getElementById(`ideal_${i}`).value = item.ideal;
                    document.getElementById(`ideal_${i}`).disabled = true; // Ideal stays the same
                    document.getElementById(`current_${i}`).value = item.current;
                    // Current can be changed for new measurement
                } else if (currentVersion === 'revised') {
                    document.getElementById(`definition_${i}`).value = item.definition || '';
                    document.getElementById(`definition_${i}`).disabled = true;
                    document.getElementById(`opposite_${i}`).value = item.opposite || '';
                    document.getElementById(`opposite_${i}`).disabled = true;
                    document.getElementById(`opposite_def_${i}`).value = item.oppositeDef || '';
                    document.getElementById(`opposite_def_${i}`).disabled = true;
                    document.getElementById(`importance_${i}`).value = item.importance;
                    document.getElementById(`importance_${i}`).disabled = true;
                    document.getElementById(`bipolar_${i}`).value = item.bipolar;
                    document.getElementById(`bipolar_rating_${i}`).textContent = item.bipolar;
                    // Bipolar can be changed for new measurement
                }
            });

            if (currentVersion === 'revised' && profile.situations) {
                const situationsInput = document.getElementById('situations');
                if (situationsInput) {
                    situationsInput.value = profile.situations;
                    situationsInput.disabled = true;
                }
            }

            // Auto-generate profile
            generateProfile();
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function deleteProfile(id) {
            if (!confirm('Weet je zeker dat je dit profiel wilt verwijderen?')) return;
            
            profiles = profiles.filter(p => p.id !== id);
            saveToStorage();
            displaySavedProfiles();
        }

        function viewMeasurements(profileId) {
            const profile = profiles.find(p => p.id === profileId);
            if (!profile || !profile.measurements) return;

            // Show modal
            const modal = document.getElementById('measurementsModal');
            modal.classList.add('active');
            
            // Set title
            document.getElementById('modalProfileName').textContent = `${profile.name} - Metingen`;

            // Display measurements list
            const measurementsList = document.getElementById('measurementsList');
            measurementsList.innerHTML = profile.measurements.map((measurement, index) => `
                <div class="measurement-item" onclick="loadMeasurement(${profileId}, ${index})">
                    <div class="measurement-header">
                        <span class="measurement-label">${measurement.label}</span>
                        <span class="measurement-date">${new Date(measurement.date).toLocaleDateString('nl-NL')}</span>
                    </div>
                    <div class="measurement-date">${measurement.data.length} kwaliteiten</div>
                </div>
            `).join('');

            // Display comparison checkboxes
            const checkboxContainer = document.getElementById('comparisonCheckboxes');
            checkboxContainer.innerHTML = profile.measurements.map((measurement, index) => `
                <div class="checkbox-container">
                    <input type="checkbox" id="compare_${index}" value="${index}">
                    <label for="compare_${index}">${measurement.label} (${new Date(measurement.date).toLocaleDateString('nl-NL')})</label>
                </div>
            `).join('');

            // Store current profile ID for comparison
            window.currentComparisonProfileId = profileId;
        }

        function closeMeasurementsModal() {
            const modal = document.getElementById('measurementsModal');
            modal.classList.remove('active');
        }

        function loadMeasurement(profileId, measurementIndex) {
            closeMeasurementsModal();
            loadProfile(profileId, measurementIndex);
        }

        function compareSelectedMeasurements() {
            const profile = profiles.find(p => p.id === window.currentComparisonProfileId);
            if (!profile) return;

            const selectedIndices = [];
            profile.measurements.forEach((_, index) => {
                const checkbox = document.getElementById(`compare_${index}`);
                if (checkbox && checkbox.checked) {
                    selectedIndices.push(index);
                }
            });

            if (selectedIndices.length < 2) {
                alert('Selecteer minimaal 2 metingen om te vergelijken!');
                return;
            }

            if (selectedIndices.length > 5) {
                alert('Selecteer maximaal 5 metingen om de grafiek overzichtelijk te houden!');
                return;
            }

            closeMeasurementsModal();
            
            // Load the profile to set correct version
            currentProfileId = profile.id;
            currentVersion = profile.version;
            
            // Update UI
            document.querySelectorAll('.version-card').forEach((card, index) => {
                card.classList.remove('active');
                const versions = ['original', 'advanced', 'revised'];
                if (versions[index] === currentVersion) {
                    card.classList.add('active');
                }
            });

            // Show comparison chart
            showComparisonChart(profile, selectedIndices);
            
            // Scroll to chart
            document.getElementById('chartSection').scrollIntoView({ behavior: 'smooth' });
        }

        function showComparisonChart(profile, measurementIndices) {
            document.getElementById('chartSection').classList.remove('hidden');
            document.getElementById('tableSection').classList.add('hidden');

            const ctx = document.getElementById('profileChart');
            
            if (currentChart) {
                currentChart.destroy();
            }

            const measurements = measurementIndices.map(i => profile.measurements[i]);
            
            if (currentVersion === 'original') {
                // For original version: use radar chart
                const qualityNames = measurements[0].data.map(d => d.name);

                const datasets = measurements.map((measurement, idx) => {
                    const colors = [
                        { bg: 'rgba(37, 99, 235, 0.2)', border: 'rgba(37, 99, 235, 1)' },
                        { bg: 'rgba(16, 185, 129, 0.2)', border: 'rgba(16, 185, 129, 1)' },
                        { bg: 'rgba(245, 158, 11, 0.2)', border: 'rgba(245, 158, 11, 1)' },
                        { bg: 'rgba(239, 68, 68, 0.2)', border: 'rgba(239, 68, 68, 1)' },
                        { bg: 'rgba(168, 85, 247, 0.2)', border: 'rgba(168, 85, 247, 1)' }
                    ];
                    const color = colors[idx % colors.length];

                    return {
                        label: measurement.label,
                        data: measurement.data.map(d => d.rating),
                        backgroundColor: color.bg,
                        borderColor: color.border,
                        borderWidth: 2,
                        pointBackgroundColor: color.border,
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: color.border,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    };
                });

                currentChart = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: qualityNames,
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 10,
                                ticks: {
                                    stepSize: 2,
                                    color: '#94a3b8',
                                    backdropColor: 'transparent',
                                    font: { size: 11 }
                                },
                                grid: {
                                    color: '#334155'
                                },
                                pointLabels: {
                                    color: '#f1f5f9',
                                    font: {
                                        size: 12,
                                        weight: '500'
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#f1f5f9',
                                    font: { size: 13 }
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(15, 23, 42, 0.95)',
                                titleColor: '#f1f5f9',
                                bodyColor: '#cbd5e1',
                                borderColor: '#334155',
                                borderWidth: 1,
                                padding: 12
                            },
                            title: {
                                display: true,
                                text: 'Vergelijking Metingen Over Tijd',
                                color: '#f1f5f9',
                                font: { size: 16, weight: '600' }
                            }
                        }
                    }
                });
            } else if (currentVersion === 'advanced' || currentVersion === 'revised') {
                // For advanced/revised: use line chart showing each quality over time
                const qualityNames = measurements[0].data.map(d => d.name);
                const measurementLabels = measurements.map(m => m.label);

                // Create one dataset per quality (each quality gets its own line)
                const colors = [
                    'rgba(37, 99, 235, 1)',
                    'rgba(16, 185, 129, 1)',
                    'rgba(245, 158, 11, 1)',
                    'rgba(239, 68, 68, 1)',
                    'rgba(168, 85, 247, 1)',
                    'rgba(236, 72, 153, 1)',
                    'rgba(14, 165, 233, 1)',
                    'rgba(132, 204, 22, 1)',
                    'rgba(249, 115, 22, 1)',
                    'rgba(59, 130, 246, 1)',
                    'rgba(34, 197, 94, 1)',
                    'rgba(251, 146, 60, 1)'
                ];

                const datasets = qualityNames.map((qualityName, qualityIndex) => {
                    const color = colors[qualityIndex % colors.length];
                    
                    // Get values for this quality across all measurements
                    const dataPoints = measurements.map(measurement => {
                        const quality = measurement.data[qualityIndex];
                        if (currentVersion === 'advanced') {
                            return quality.current;
                        } else {
                            return quality.bipolar;
                        }
                    });

                    return {
                        label: qualityName,
                        data: dataPoints,
                        borderColor: color,
                        backgroundColor: color.replace('1)', '0.1)'),
                        borderWidth: 2,
                        pointBackgroundColor: color,
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 5,
                        pointHoverRadius: 7,
                        tension: 0.3,
                        fill: false
                    };
                });

                currentChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: measurementLabels,
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: currentVersion === 'advanced' ? 10 : 7,
                                ticks: { 
                                    color: '#94a3b8',
                                    stepSize: 1,
                                    font: { size: 11 }
                                },
                                grid: { 
                                    color: 'rgba(51, 65, 85, 0.5)',
                                    drawBorder: false
                                },
                                border: {
                                    display: false
                                },
                                title: {
                                    display: true,
                                    text: currentVersion === 'advanced' ? 'Score (1-10)' : 'Score (1-7)',
                                    color: '#cbd5e1',
                                    font: { size: 12 }
                                }
                            },
                            x: {
                                ticks: { 
                                    color: '#cbd5e1',
                                    font: { size: 12 }
                                },
                                grid: { 
                                    display: false
                                },
                                border: {
                                    display: false
                                },
                                title: {
                                    display: true,
                                    text: 'Metingen',
                                    color: '#cbd5e1',
                                    font: { size: 12 }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#f1f5f9',
                                    font: { size: 12 },
                                    padding: 10,
                                    usePointStyle: true,
                                    pointStyle: 'circle'
                                },
                                position: 'right'
                            },
                            tooltip: {
                                backgroundColor: 'rgba(15, 23, 42, 0.95)',
                                titleColor: '#f1f5f9',
                                bodyColor: '#cbd5e1',
                                borderColor: '#334155',
                                borderWidth: 1,
                                padding: 12,
                                displayColors: true
                            },
                            title: {
                                display: true,
                                text: 'Ontwikkeling Kwaliteiten Over Tijd',
                                color: '#f1f5f9',
                                font: { size: 16, weight: '600' },
                                padding: { bottom: 20 }
                            }
                        },
                        interaction: {
                            mode: 'index',
                            intersect: false
                        }
                    }
                });
            }
        }

        function resetProfile() {
            document.getElementById('profileName').value = '';
            document.getElementById('profileName').disabled = false;
            document.getElementById('numQualities').value = 8;
            document.getElementById('numQualities').disabled = false;
            document.getElementById('qualitiesContainer').innerHTML = '';
            document.getElementById('chartSection').classList.add('hidden');
            document.getElementById('tableSection').classList.add('hidden');
            currentProfileId = null; // Clear current profile
            
            // Hide status and help
            document.getElementById('profileStatus').style.display = 'none';
            document.getElementById('newMeasurementHelp').style.display = 'none';
            
            // Reset button text
            document.getElementById('saveBtn').innerHTML = 'ðŸ’¾ Profiel Opslaan';
            
            if (currentChart) {
                currentChart.destroy();
                currentChart = null;
            }
        }

        // Initialize
        loadProfiles();

        async function exportToPDF() {
            const { jsPDF } = window.jspdf;
            
            // Check if profile has been generated
            const chartSection = document.getElementById('chartSection');
            if (chartSection.classList.contains('hidden')) {
                alert('Genereer eerst een profiel voordat je het exporteert!');
                return;
            }

            const profileName = document.getElementById('profileName').value || 'Performance Profiel';
            const pdf = new jsPDF('p', 'mm', 'a4');
            const pageWidth = pdf.internal.pageSize.getWidth();
            const pageHeight = pdf.internal.pageSize.getHeight();
            const margin = 20;
            let yPosition = margin;

            // Add header
            pdf.setFontSize(24);
            pdf.setTextColor(37, 99, 235);
            pdf.text('Performance Profiling', margin, yPosition);
            yPosition += 10;

            pdf.setFontSize(16);
            pdf.setTextColor(100, 100, 100);
            const versionNames = {
                'original': 'Originele Versie (Butler & Hardy, 1992)',
                'advanced': 'Geavanceerde Versie (Jones, 1993)',
                'revised': 'Herziene Versie (Gucciardi & Gordon, 2009)'
            };
            pdf.text(versionNames[currentVersion], margin, yPosition);
            yPosition += 15;

            pdf.setFontSize(14);
            pdf.setTextColor(50, 50, 50);
            pdf.text(profileName, margin, yPosition);
            yPosition += 5;
            
            pdf.setFontSize(10);
            pdf.setTextColor(150, 150, 150);
            pdf.text(new Date().toLocaleDateString('nl-NL'), margin, yPosition);
            yPosition += 15;

            // Add separator line
            pdf.setDrawColor(200, 200, 200);
            pdf.line(margin, yPosition, pageWidth - margin, yPosition);
            yPosition += 15;

            // Capture chart
            const chartCanvas = document.getElementById('profileChart');
            if (chartCanvas && currentChart) {
                try {
                    const chartImage = chartCanvas.toDataURL('image/png', 1.0);
                    const chartWidth = pageWidth - (2 * margin);
                    const chartHeight = 120;
                    
                    pdf.addImage(chartImage, 'PNG', margin, yPosition, chartWidth, chartHeight);
                    yPosition += chartHeight + 15;
                } catch (error) {
                    console.error('Error capturing chart:', error);
                }
            }

            // Add table data
            if (currentVersion === 'original') {
                pdf.setFontSize(12);
                pdf.setTextColor(50, 50, 50);
                pdf.text('Kwaliteiten Overzicht', margin, yPosition);
                yPosition += 8;

                const num = parseInt(document.getElementById('numQualities').value);
                pdf.setFontSize(10);
                
                for (let i = 1; i <= num; i++) {
                    const qualityName = document.getElementById(`quality_${i}`)?.value;
                    if (!qualityName) continue;
                    
                    const rating = parseInt(document.getElementById(`rating_${i}_slider`).value);
                    
                    // Check if we need a new page
                    if (yPosition > pageHeight - 30) {
                        pdf.addPage();
                        yPosition = margin;
                    }
                    
                    pdf.setTextColor(50, 50, 50);
                    pdf.text(`${qualityName}:`, margin, yPosition);
                    pdf.setTextColor(37, 99, 235);
                    pdf.text(`${rating}/10`, pageWidth - margin - 20, yPosition);
                    yPosition += 7;
                }
            } else if (currentVersion === 'advanced') {
                pdf.setFontSize(12);
                pdf.setTextColor(50, 50, 50);
                pdf.text('Discrepancy Scores', margin, yPosition);
                yPosition += 10;

                const num = parseInt(document.getElementById('numQualities').value);
                const data = [];

                for (let i = 1; i <= num; i++) {
                    const qualityName = document.getElementById(`quality_${i}`)?.value;
                    if (!qualityName) continue;
                    
                    const importance = parseInt(document.getElementById(`importance_${i}`).value);
                    const ideal = parseInt(document.getElementById(`ideal_${i}`).value);
                    const current = parseInt(document.getElementById(`current_${i}`).value);
                    const discrepancy = (ideal - current) * importance;
                    
                    data.push({ name: qualityName, importance, ideal, current, discrepancy });
                }

                data.sort((a, b) => b.discrepancy - a.discrepancy);

                pdf.setFontSize(9);
                pdf.setTextColor(100, 100, 100);
                pdf.text('Kwaliteit', margin, yPosition);
                pdf.text('Belang', margin + 70, yPosition);
                pdf.text('Ideaal', margin + 95, yPosition);
                pdf.text('Huidig', margin + 120, yPosition);
                pdf.text('Discrepancy', margin + 145, yPosition);
                yPosition += 7;

                pdf.setDrawColor(200, 200, 200);
                pdf.line(margin, yPosition, pageWidth - margin, yPosition);
                yPosition += 5;

                pdf.setFontSize(10);
                data.forEach(item => {
                    if (yPosition > pageHeight - 30) {
                        pdf.addPage();
                        yPosition = margin;
                    }

                    pdf.setTextColor(50, 50, 50);
                    pdf.text(item.name.substring(0, 25), margin, yPosition);
                    pdf.text(`${item.importance}/10`, margin + 70, yPosition);
                    pdf.text(`${item.ideal}/10`, margin + 95, yPosition);
                    pdf.text(`${item.current}/10`, margin + 120, yPosition);
                    
                    // Color code discrepancy
                    if (item.discrepancy > 30) pdf.setTextColor(239, 68, 68);
                    else if (item.discrepancy > 15) pdf.setTextColor(245, 158, 11);
                    else pdf.setTextColor(16, 185, 129);
                    
                    pdf.text(`${item.discrepancy}`, margin + 145, yPosition);
                    yPosition += 7;
                });
            } else if (currentVersion === 'revised') {
                pdf.setFontSize(12);
                pdf.setTextColor(50, 50, 50);
                pdf.text('Bipolaire Kwaliteiten', margin, yPosition);
                yPosition += 10;

                const num = parseInt(document.getElementById('numQualities').value);

                pdf.setFontSize(9);
                pdf.setTextColor(100, 100, 100);
                pdf.text('Kwaliteit', margin, yPosition);
                pdf.text('Tegengestelde', margin + 60, yPosition);
                pdf.text('Belang', margin + 120, yPosition);
                pdf.text('Score', margin + 150, yPosition);
                yPosition += 7;

                pdf.setDrawColor(200, 200, 200);
                pdf.line(margin, yPosition, pageWidth - margin, yPosition);
                yPosition += 5;

                pdf.setFontSize(9);
                for (let i = 1; i <= num; i++) {
                    const qualityName = document.getElementById(`quality_${i}`)?.value;
                    if (!qualityName) continue;
                    
                    if (yPosition > pageHeight - 40) {
                        pdf.addPage();
                        yPosition = margin;
                    }

                    const opposite = document.getElementById(`opposite_${i}`)?.value || '-';
                    const importance = parseInt(document.getElementById(`importance_${i}`).value);
                    const bipolar = parseInt(document.getElementById(`bipolar_${i}`).value);
                    
                    pdf.setTextColor(50, 50, 50);
                    pdf.text(qualityName.substring(0, 20), margin, yPosition);
                    pdf.text(opposite.substring(0, 20), margin + 60, yPosition);
                    pdf.text(`${importance}/10`, margin + 120, yPosition);
                    
                    if (bipolar <= 3) pdf.setTextColor(239, 68, 68);
                    else if (bipolar <= 5) pdf.setTextColor(245, 158, 11);
                    else pdf.setTextColor(16, 185, 129);
                    
                    pdf.text(`${bipolar}/7`, margin + 150, yPosition);
                    yPosition += 7;
                }

                // Add situations if present
                const situations = document.getElementById('situations')?.value;
                if (situations) {
                    yPosition += 10;
                    
                    if (yPosition > pageHeight - 50) {
                        pdf.addPage();
                        yPosition = margin;
                    }

                    pdf.setFontSize(12);
                    pdf.setTextColor(50, 50, 50);
                    pdf.text('Belangrijke Situaties', margin, yPosition);
                    yPosition += 8;

                    pdf.setFontSize(10);
                    pdf.setTextColor(100, 100, 100);
                    const lines = pdf.splitTextToSize(situations, pageWidth - (2 * margin));
                    pdf.text(lines, margin, yPosition);
                }
            }

            // Add footer
            const totalPages = pdf.internal.pages.length - 1;
            for (let i = 1; i <= totalPages; i++) {
                pdf.setPage(i);
                pdf.setFontSize(8);
                pdf.setTextColor(150, 150, 150);
                pdf.text(
                    `Pagina ${i} van ${totalPages}`,
                    pageWidth - margin - 20,
                    pageHeight - 10
                );
                pdf.text(
                    'Gegenereerd met Performance Profiling Tool',
                    margin,
                    pageHeight - 10
                );
            }

            // Save PDF
            const fileName = `${profileName.replace(/[^a-z0-9]/gi, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
            pdf.save(fileName);
        }
    </script>
</body>
</html>